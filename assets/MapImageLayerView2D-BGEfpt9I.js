import{iY as n,bF as g,aU as d,iZ as l,cR as u,x as h,y as m,B as c}from"./index-DPJiPkbh.js";import{a as f}from"./BitmapContainer-UYbTDRWc.js";import{m as y}from"./LayerView2D-PBUj6K28.js";import{$ as _}from"./GraphicsView2D-CQiay_dM.js";import{h as H}from"./HighlightGraphicContainer-dIBYk1N_.js";import{v as w}from"./ExportStrategy-DBaM8v3A.js";import{u as v}from"./LayerView-DYVP3cuG.js";import{p as x}from"./MapImageLayerView-CRnR3Bvn.js";import{i as U}from"./RefreshableLayerView-TgkXS-ig.js";import{U as $}from"./MapServiceLayerViewHelper-NRExOe3T.js";import"./WGLContainer-Dv5NxOAK.js";import"./definitions-B54owTRu.js";import"./LabelMetric-BJcGSDIa.js";import"./enums-DSseSvdG.js";import"./enums-BRqP_wXA.js";import"./Texture-BRxaK8g9.js";import"./Program-DCRJBPTx.js";import"./BufferObject-wa67LmxE.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./BoundingBox-BhuXqU4L.js";import"./vec2f32-BbH2jxlN.js";import"./VertexArrayObject-BGsrrzff.js";import"./WGLBrushVTLSymbol-BM1EGGpB.js";import"./DefaultUI-y65bhLzJ.js";import"./ReactiveMap-sicXFvKD.js";import"./IViewEvents-Bci6PjlS.js";import"./interfaces-D6pIddIh.js";import"./heightModelInfoUtils-irmNrBgu.js";import"./mat2df64-CBKYtunK.js";import"./mat3-CakTilsz.js";import"./normalizeUtils-CVZirBXT.js";import"./normalizeUtilsCommon-DTYpWx_K.js";import"./capabilities-C84AMSCg.js";import"./themeUtils-C3zvZbsE.js";import"./accessibleHandler-XhnTPGUg.js";import"./Compass-DbISr2nW.js";import"./utils-DsJqvptN.js";import"./GoTo-28s5bp4H.js";import"./NavigationToggle-DiUrJhDe.js";import"./Zoom-D-LKGxB_.js";import"./vec4f32-CjrfB-0a.js";import"./StyleDefinition-pu9RBNlY.js";import"./config-MDUrh2eL.js";import"./ShaderCompiler-G2XYGDs6.js";import"./ProgramTemplate-Idpt-hsH.js";import"./DefaultVertexAttributeLayouts-BBe0WA5l.js";import"./DisplayObject-jRWssau_.js";import"./TileKey-BicQgvrV.js";import"./Container-D-UnjuYH.js";import"./EffectView-DBKHGQIz.js";import"./highlightReasons-C6XJZYBL.js";import"./Tile-C2x0ojRV.js";import"./quickselect-deeG3Iol.js";import"./earcut-nZVQjWaZ.js";import"./featureConversionUtils-DQOpYys3.js";import"./OptimizedFeature-CXeSoBCN.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./OptimizedGeometry-DLPswkPy.js";import"./scaleUtils-C37jhR61.js";import"./ClipRect-Hx0McZSN.js";import"./CIMSymbolHelper-Do5YMnYc.js";import"./BidiEngine-BwB1Df7c.js";import"./fontUtils-CPCkP0Vo.js";import"./GeometryUtils-CYtATAOa.js";import"./Rect-CUzevAry.js";import"./AttributeStore-DNuJKA2n.js";import"./UpdateTracking2D-Bx7nYhX8.js";import"./TurboLine-CEECPkhn.js";import"./BindType-BmZEZMMh.js";import"./Util-C76gCxal.js";import"./constants-D5zmR9t2.js";import"./labelFormatUtils-D6Y1wMdU.js";import"./centroid-DdLmOD72.js";import"./timeSupport-CgWQEL9f.js";import"./json-Wa8cmqdu.js";import"./FeatureCommandQueue-D5rkXNyk.js";import"./heatmapTextureUtils-CSQ77pgu.js";import"./QueueProcessor-DdpNWD80.js";import"./normalizeUtilsSync-flSlqQpY.js";import"./AGraphicContainer-CGJW73Pm.js";import"./TechniqueInstance-XVKMxhdo.js";import"./TileContainer-CwVZt8Bm.js";import"./vec3f32-Cw9Q6TO_.js";import"./TileInfo-Lr1EBoW1.js";import"./TileKey-DZd6gJy7.js";import"./Bitmap-8kVunml_.js";import"./TileStrategy-Bs8uTjKa.js";import"./ExportImageParameters-Bur-_bF5.js";import"./sublayerUtils-DwYFfJ88.js";import"./popupUtils-DP5YqEgW.js";let p=class extends x(U(y(v))){constructor(){super(...arguments),this._highlightGraphics=new n,this._updateHash=""}fetchPopupFeaturesAtLocation(t,i){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,i)}update(t){const i=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==i&&(this._updateHash=i,this.strategy.update(t).catch(r=>{g(r)||d.getLogger(this).error(r)}),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:i,version:r}=this.layer,e=r>=10.3,s=r>=10;this._bitmapContainer=new f,this.container.addChild(this._bitmapContainer),this._highlightView=new _({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new H(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new $({createFetchPopupFeaturesQueryGeometry:(o,a)=>l(o,a,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(o,a)=>{this._highlightView.graphicUpdateHandler({graphic:o,property:a})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new w({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:i,imageRotationSupported:e,imageNormalizationSupported:s,hidpi:!0}),this.addAttachHandles(u(()=>this.exportImageVersion,()=>this.requestUpdate())),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,i,r,e){return this.layer.fetchImage(t,i,r,{timeExtent:this.timeExtent,floors:this.floors,...e})}fetchImageBitmap(t,i,r,e){return this.layer.fetchImageBitmap(t,i,r,{timeExtent:this.timeExtent,floors:this.floors,...e})}highlight(t){return this._popupHighlightHelper.highlight(t)}};h([m()],p.prototype,"strategy",void 0),h([m()],p.prototype,"updating",void 0),p=h([c("esri.views.2d.layers.MapImageLayerView2D")],p);const hi=p;export{hi as default};
