import{ab as m,ac as g,E as p,ad as v,s as _,x as a,y as i,B as T,ae as k,af as w,ag as F}from"./index-B252NKV0.js";import{i as x,e as E,h as $}from"./progressUtils-Ci7RE5SS.js";let o=class extends m{constructor(){super({}),this.files=[],this.progress=0,this._uploadTask=null,this._layer=null}destroy(){this.cancel(),this.files=[],this._layer=null,this._uploadTask=null}get state(){const e=this._uploadTask;return e&&this.files.length!==0?e.finished?e.error?"error":"success":"pending":"default"}get result(){var e;return((e=this._uploadTask)==null?void 0:e.value)??null}get error(){var e;return((e=this._uploadTask)==null?void 0:e.error)??null}uploadTo(e){this.cancel(),this.files=[],this._layer=e,this._uploadTask=g(async s=>{const r=await b(e);p(s),this.progress=0,this.files=r;const t=x(E.upload,c=>{this.progress=c},"Upload.uploadTo");if(r.length===0)return null;p(s);const l=await e.extractAndFilterFiles(r);p(s),l.length>0&&(this.files=l);const d=new v({x:0,y:0,z:0,spatialReference:e.spatialReference}),u=await e.convertMesh(l,{location:d,signal:s,onProgress:t.makeOnProgress("createFromFiles")});if(p(s),!u)throw new _("editor:upload","could not upload or convert model");const h=l.reduce((c,y)=>c+y.size,0),f=t.simulate("loadMesh",$(h));try{await u.load()}finally{f.remove()}return u})}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){var e;(e=this._uploadTask)==null||e.abort()}};a([i()],o.prototype,"files",void 0),a([i()],o.prototype,"progress",void 0),a([i()],o.prototype,"state",null),a([i()],o.prototype,"result",null),a([i()],o.prototype,"error",null),a([i()],o.prototype,"_uploadTask",void 0),a([i()],o.prototype,"_layer",void 0),o=a([T("esri.widgets.Editor.Upload")],o);let n=null;async function b(e){const{resolve:s,promise:r}=k(),t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=[...w(e.infoFor3D),".zip"].join(","),t.style.display="none",document.body.appendChild(t);const l=F(t,"change",()=>s(t.files?Array.from(t.files):[]));return n?n(t):t.click(),r.finally(()=>{l.remove(),t.remove()})}function S(e){n=s=>{Promise.resolve().then(()=>e).then(r=>{if(!n)return;const t=new DataTransfer;r.forEach(l=>t.items.add(l)),s.files=t.files,s.dispatchEvent(new Event("change"))})}}function U(){n=null}export{o as Upload,U as clearPromptForFilesStub,S as stubFilePickerToSelect};
