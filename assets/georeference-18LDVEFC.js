import{x as h,y as x,B as Ae,z as $e,bO as U,nT as de,c1 as xe,c3 as b,nU as Pe,cq as te,cz as M,cs as Z,nV as Fe,dh as Te,aY as Me,aU as W,gZ as O,ff as k,nW as ve,cx as we,nX as be,nY as Re,nZ as Ce,di as re,dW as _e,b3 as Oe,mg as Se,dU as H,n_ as _,n$ as Ee,cp as je,dr as ze,eo as Ne}from"./index-DPJiPkbh.js";import{n as X,u as J,j as E,z as ne}from"./mat3-CakTilsz.js";import{a as w}from"./spatialReferenceEllipsoidUtils-MJ9Uj9G-.js";import{R as S}from"./computeTranslationToOriginAndRotation-DJULrcwj.js";import{t as K,o as Ge}from"./DoubleArray-MGZZXTmk.js";import{I as Le}from"./quat-B_RTSvGc.js";import{C as Ve,q as We,y as Q,z as Be,A as Ie}from"./axisAngleDegrees-B1MWDIoz.js";import{g as j,f as Ue,u as oe}from"./meshVertexSpaceUtils-BjFcMx2J.js";import{n as F,s as ae,i as Ye,r as v}from"./vec3-CkCkHRdL.js";import{i as A,T as $}from"./BufferView-D7hl-e1J.js";var B;let y=B=class extends $e{constructor(e){super(e),this.translation=U(),this.rotationAxis=de(Ve),this.rotationAngle=0,this.scale=xe(1,1,1)}get rotation(){return We(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=b(Q(e)),this.rotationAngle=Be(e)}get localMatrix(){const e=M();return Le(D,Q(this.rotation),Ie(this.rotation)),Pe(e,D,this.translation,this.scale),e}get localMatrixInverse(){return te(M(),this.localMatrix)}applyLocal(e,t){return Z(t,e,this.localMatrix)}applyLocalInverse(e,t){return Z(t,e,this.localMatrixInverse)}equals(e){return this===e||e!=null&&Fe(this.localMatrix,e.localMatrix)}clone(){const e={translation:b(this.translation),rotationAxis:b(this.rotationAxis),rotationAngle:this.rotationAngle,scale:b(this.scale)};return new B(e)}};h([x({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"translation",void 0),h([x({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"rotationAxis",void 0),h([x({type:Number,nonNullable:!0,json:{write:!0}})],y.prototype,"rotationAngle",void 0),h([x({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"scale",void 0),h([x()],y.prototype,"rotation",null),h([x()],y.prototype,"localMatrix",null),h([x()],y.prototype,"localMatrixInverse",null),y=B=h([Ae("esri.geometry.support.MeshTransform")],y);const D=Te(),ee=y;function ie(e,t){return e.isGeographic||e.isWebMercator&&(t??!0)}function se(e,t){switch(e.type){case"georeferenced":return t.isGeographic;case"local":return t.isGeographic||t.isWebMercator}}function Pt(e,t,r,n){if(n!==void 0){Me(W.getLogger(e),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const o=t.type==="local";if(!j(t)||n===o)return r.isGeographic||r.isWebMercator&&n;W.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${n}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}return se(t,r)}const z=()=>W.getLogger("esri.geometry.support.meshUtils.normalProjection");function qe(e,t,r,n,o){return G(n)?(N(m.TO_PCPF,A.fromTypedArray(e),$.fromTypedArray(t),$.fromTypedArray(r),n,A.fromTypedArray(o)),o):(z().error("Cannot convert spatial reference to PCPF"),o)}function Ze(e,t,r,n,o){return G(n)?(N(m.FROM_PCPF,A.fromTypedArray(e),$.fromTypedArray(t),$.fromTypedArray(r),n,A.fromTypedArray(o)),o):(z().error("Cannot convert to spatial reference from PCPF"),o)}function ke(e,t,r){return O(e,t,0,r,w(t),0,e.length/3),r}function He(e,t,r){return O(e,w(r),0,t,r,0,e.length/3),t}function Xe(e,t,r){return E(u,r),F(t,e,u),ne(u)||ae(t,t),t}function Je(e,t,r){if(E(u,r),F(t,e,u,4),ne(u)||ae(t,t,4),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Ke(e,t,r,n,o){if(!G(n))return z().error("Cannot convert spatial reference to PCPF"),o;N(m.TO_PCPF,A.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),$.fromTypedArray(t),$.fromTypedArray(r),n,A.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<e.length;a+=4)o[a]=e[a];return o}function Qe(e,t,r,n,o){if(!G(n))return z().error("Cannot convert to spatial reference from PCPF"),o;N(m.FROM_PCPF,A.fromTypedArray(e,16),$.fromTypedArray(t),$.fromTypedArray(r),n,A.fromTypedArray(o,16));for(let a=3;a<e.length;a+=4)o[a]=e[a];return o}function N(e,t,r,n,o,a){if(!t)return;const l=r.count,c=w(o);if(le(o))for(let i=0;i<l;i++)n.getVec(i,R),t.getVec(i,g),S(c,R,C,c),X(u,C),e===m.FROM_PCPF&&J(u,u),k(g,g,u),a.setVec(i,g);else for(let i=0;i<l;i++){n.getVec(i,R),t.getVec(i,g),S(c,R,C,c),X(u,C);const s=ve(r.get(i,1));let f=Math.cos(s);e===m.TO_PCPF&&(f=1/f),u[0]*=f,u[1]*=f,u[2]*=f,u[3]*=f,u[4]*=f,u[5]*=f,e===m.FROM_PCPF&&J(u,u),k(g,g,u),we(g,g),a.setVec(i,g)}return a}function G(e){return le(e)||De(e)}function le(e){return e.isWGS84||be(e)||Re(e)||Ce(e)}function De(e){return e.isWebMercator}var m;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(m||(m={}));const R=U(),g=U(),C=M(),u=re();function Y(e,t,r){return ie(t.spatialReference,r==null?void 0:r.geographic)?q(e,t,!1,r):nt(e,t,r)}function ce(e,t=_){const{position:r,normal:n,tangent:o}=e;return{position:v(new Float64Array(r.length),r,t),normal:n!=null?Xe(n,new Float32Array(n.length),t):null,tangent:o!=null?Je(o,new Float32Array(o.length),t):null}}function ue(e,t,r,n){const{position:o,normal:a,tangent:l}=e;if(!j(t))return{position:o,normal:a,tangent:l};const c=oe(t,n);return Y(ce(e,r==null?void 0:r.localMatrix),c,{geographic:t.type==="local"})}function et(e,t,r){const n=Ue(t,r),o=t.spatialReference,a=j(n);if(!a)return{vertexAttributes:Y(e,t,r),vertexSpace:n,transform:null};const{position:l,normal:c,tangent:i}=e,s=se(n,o);switch(n.type){case"georeferenced":return s?{vertexAttributes:q(e,t,a,r),vertexSpace:n,transform:null}:{vertexAttributes:{position:l,normal:c,tangent:i},vertexSpace:n,transform:new ee};case"local":return{vertexAttributes:{position:l,normal:c,tangent:i},vertexSpace:n,transform:new ee}}}function I(e,t,r){return ie(t.spatialReference,r==null?void 0:r.geographic)?pe(e,t,r):fe(e,t,r)}function tt(e,t,r,n,o){if(!j(t))return I(e,n,o);const{spatialReference:a}=n,l=ue(e,t,r,a);return n.equals(oe(t,a))?fe(l,n,o):I(l,n,o)}function rt({positions:e,transform:t,vertexSpace:r,inSpatialReference:n,outSpatialReference:o,outPositions:a,localMode:l}){const c=r.origin??H,i=r.origin!=null?(t==null?void 0:t.localMatrix)??_:_;if(r.type==="georeferenced"){const p=a??K(e.length);if(Ee(i,_)?Ge(p,e):v(p,e,i),!je(c,H)){const[V,me,he]=c;for(let T=0;T<p.length;T+=3)p[T]+=V,p[T+1]+=me,p[T+2]+=he}return O(p,n,0,p,o,0,p.length/3),p}let s=n;const f=w(n);s=o.isWebMercator&&l||!ze(n,f)?s:f,S(n,c,P,s),Ne(P,P,i);const d=a??K(e.length);return v(d,e,P),O(d,s,0,d,o,0,d.length/3),d}function nt(e,t,r){const n=new Float64Array(e.position.length),o=e.position,a=t.x,l=t.y,c=t.z??0,i=L(r?r.unit:null,t.spatialReference);for(let s=0;s<o.length;s+=3)n[s]=o[s]*i+a,n[s+1]=o[s+1]*i+l,n[s+2]=o[s+2]*i+c;return{position:n,normal:e.normal,tangent:e.tangent}}function q(e,t,r,n){const o=t.spatialReference,a=ge(t,n,P),l=new Float64Array(e.position.length),c=ot(e.position,a,o,l),i=E(ye,a),s=at(c,l,e.normal,i,o),f=it(c,l,e.tangent,i,o);if(r){const{x:d,y:p,z:V}=t;Ye(c,c,[-d,-p,-(V??0)])}return{position:c,normal:s,tangent:f}}function ot(e,t,r,n){v(n,e,t);const o=new Float64Array(e.length);return He(n,o,r)}function at(e,t,r,n,o){if(r==null)return null;const a=new Float32Array(r.length);return F(a,r,n),Ze(a,e,t,o,a),a}function it(e,t,r,n,o){if(r==null)return null;const a=new Float32Array(r.length);F(a,r,n,4);for(let l=3;l<a.length;l+=4)a[l]=r[l];return Qe(a,e,t,o,a),a}function fe(e,t,r){const n=new Float64Array(e.position.length),o=e.position,a=t.x,l=t.y,c=t.z??0,i=L(r?r.unit:null,t.spatialReference);for(let s=0;s<o.length;s+=3)n[s]=(o[s]-a)/i,n[s+1]=(o[s+1]-l)/i,n[s+2]=(o[s+2]-c)/i;return{position:n,normal:e.normal,tangent:e.tangent}}function pe(e,t,r){const n=t.spatialReference;ge(t,r,P);const o=te(ut,P),a=new Float64Array(e.position.length),l=st(e.position,n,o,a),c=E(ye,o);return{position:l,normal:lt(e.normal,e.position,a,n,c),tangent:ct(e.tangent,e.position,a,n,c)}}function ge(e,t,r){S(e.spatialReference,[e.x,e.y,e.z??0],r,w(e.spatialReference));const n=L(t?t.unit:null,e.spatialReference);return _e(r,r,[n,n,n]),r}function st(e,t,r,n){const o=ke(e,t,n),a=new Float64Array(o.length);return v(a,o,r),a}function lt(e,t,r,n,o){if(e==null)return null;const a=qe(e,t,r,n,new Float32Array(e.length));return F(a,a,o),a}function ct(e,t,r,n,o){if(e==null)return null;const a=Ke(e,t,r,n,new Float32Array(e.length));return F(a,a,o,4),a}function L(e,t){if(e==null)return 1;const r=Oe(t);return 1/Se(r,"meters",e)}const P=M(),ut=M(),ye=re(),Ft=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:ce,georeference:Y,georeferenceApplyTransform:ue,georeferenceByTransform:et,georeferenceGlobal:q,getUnitScale:L,project:rt,ungeoreference:I,ungeoreferenceByTransform:tt,ungeoreferenceGlobal:pe},Symbol.toStringTag,{value:"Module"}));export{tt as C,He as E,rt as G,q as I,Xe as M,ke as O,ue as P,pe as Q,Je as R,et as V,L as _,Ze as a,Qe as b,Pt as c,ee as d,ce as e,Ft as g,Ke as h,qe as j};
