import{s,ad as l,iz as d,p as g,n as m,J as c,Q as p,aJ as f,aU as v}from"./index-DPJiPkbh.js";const u=()=>v.getLogger("esri.widgets.support.geolocationUtils"),w={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function h(){const e=f("esri-geolocation");return e||u().warn("geolocation-unsupported","Geolocation unsupported."),e}function y(){const e=window.isSecureContext;return e||u().warn("insecure-context","Geolocation requires a secure origin."),e}function $(){return h()&&y()}function A(e){return e||(e=w),new Promise((o,i)=>{setTimeout(()=>i(new s("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(o,i,e??void 0)})}function R(e,t){const{position:o,view:i}=e,r=P(o),n=r==null?void 0:r.coords;if(!n)throw new s("geometry-service:no-coords","Geolocation has no coordinates");return x(S(n),i,t)}function P(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:o,timestamp:e.timestamp}}function S({longitude:e,latitude:t,altitude:o}){return new l({longitude:e,latitude:t,z:o||void 0,spatialReference:{wkid:4326}})}function x(e,t,o){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(d(e)):G(o).then(r=>{if(!r)throw new s("geometry-service:missing-url","Geometry service URL is missing");const n=new g({geometries:[e],outSpatialReference:i});return m(r,n,o).then(a=>a[0])})}function G(e){if(c.geometryServiceUrl)return Promise.resolve(c.geometryServiceUrl);const t=p.getDefault();return t.load(e).catch(()=>{}).then(()=>{var o,i;return(i=(o=t.helperServices)==null?void 0:o.geometry)==null?void 0:i.url})}export{R as f,$ as g,A as p};
