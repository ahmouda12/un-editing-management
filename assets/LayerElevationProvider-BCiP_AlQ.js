import{k5 as y,k6 as w,k7 as z,k8 as a,G as H,ce as M,gN as C,ma as _,eX as A,ab as F,bL as j,aU as L,e_ as S,jm as B,cs as G,i5 as P,x as h,y as v,B as W,cz as k,h8 as T,bO as x}from"./index-B252NKV0.js";import{a as I}from"./RenderTexture-BMjKBFU6.js";import{e as b}from"./ElevationRange-BrgM1moX.js";import{e as q}from"./WaterSurface.glsl-DJiRVkTI.js";import{T as U,t as D}from"./ElevationProvider-Z72XcWTz.js";function ee(e,n,t,s){if(n==null||s==null)return!1;const r=y(n,w),i=y(s,z);if(r===i&&r!==a.UNKNOWN||H(n,s))return t[0]=1,t[1]=1,t[2]=1,!0;if(r===a.SPHERICAL_ECEF){const c=M(e),u=c/Math.sqrt(e[0]*e[0]+e[1]*e[1]),p=c/C.radius;if(i===a.WEB_MERCATOR)return t[0]=u*p,t[1]=u*p,t[2]=1,!0;if(i===a.WGS84||i===a.CGCS2000){const o=_;return t[0]=o*u*p,t[1]=o*p,t[2]=1,!0}}else if(r===a.PLATE_CARREE){if(i===a.WGS84||i===a.CGCS2000)return t[0]=_,t[1]=_,t[2]=1,!0;if(i===a.WEB_MERCATOR){const c=e[1]/C.radius;return t[0]=1,t[1]=1/Math.cos(c),t[2]=1,!0}}return!1}let m=class extends A.EventedMixin(F){constructor(e){super(e),this._tmpEvent=new q,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=U(this.view.state.viewingMode),this._intersector.options.store=D.MIN,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,n;return(n=(e=this.view)==null?void 0:e.elevationProvider)==null?void 0:n.spatialReference}getElevation(e,n,t,s){const r=this._renderCoordsHelper,i=j(l,e,n,t);if(!r.toRenderCoords(i,s,i))return L.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:c,_intersector:u,intersectionHandler:p}=this,o=c.fullExtent,f=o!=null&&Number.isFinite(o.xmin)&&Number.isFinite(o.xmax)&&Number.isFinite(o.ymin)&&Number.isFinite(o.ymax)&&Number.isFinite(o.zmin)&&Number.isFinite(o.zmax)?new b(o.zmin,o.zmax):c.elevationRange;if(f==null)return null;const R=c.elevationOffset,N=f.elevationRangeMin+R,O=f.elevationRangeMax+R,E=r.setAltitude(K,O,i),g=r.setAltitude(X,N,i);return u.reset(E,g,null),p.intersect(u,null,E,g,null,!0),u.results.min.getIntersectionPoint(i)?r.getAltitude(i):null}getSphereElevationBounds(e,n){return I(e,n,$,this._renderSR),this._layerElevationSource.getElevationRange($)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e!=null&&e.hasZ?new b(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){S(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){S(n);for(const t of e)this._expandExtent(t,n)}_expandExtent(e,n){const t=this.spatialReference;if(t==null||e==null)return;B(d,e.quaternion),d[12]=e.center[0],d[13]=e.center[1],d[14]=e.center[2];const s=e.halfSize;for(let r=0;r<8;++r)l[0]=1&r?s[0]:-s[0],l[1]=2&r?s[1]:-s[1],l[2]=4&r?s[2]:-s[2],G(l,l,d),this._renderCoordsHelper.fromRenderCoords(l,l,t),P(n,l,n)}};h([v({constructOnly:!0})],m.prototype,"layerElevationSource",void 0),h([v({constructOnly:!0})],m.prototype,"intersectionHandler",void 0),h([v({constructOnly:!0})],m.prototype,"view",void 0),h([v()],m.prototype,"spatialReference",null),m=h([W("esri.views.3d.layers.i3s.LayerElevationProvider")],m);const d=k(),$=T(0,0,0,0),l=x(),K=x(),X=x();export{ee as f,m as x};
