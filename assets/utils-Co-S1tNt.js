const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B252NKV0.js","assets/index-HngaTkmj.css"])))=>i.map(i=>d[i]);
import{gR as I,_ as h,b_ as C,gm as E,gl as x,gk as V,of as $,fh as f,og as N,gQ as R,oh as p,oi as U,iG as O}from"./index-B252NKV0.js";const _=/^-?(\d+)(\.(\d+))?$/i;function B(t,e){return t-e}function M(t,e){let n,a;return n=Number(t.toFixed(e)),n<t?a=n+1/10**e:(a=n,n-=1/10**e),n=Number(n.toFixed(e)),a=Number(a.toFixed(e)),[n,a]}function S(t,e,n,a,o){const l=k(t,e,n,a),r=l.previous==null||l.previous<=o,i=l.next==null||l.next<=o;return r&&i||l.previous+l.next<=2*o}function v(t){const e=String(t),n=e.match(_);if(n&&n[1])return{integer:n[1].split("").length,fractional:n[3]?n[3].split("").length:0};if(e.toLowerCase().includes("e")){const a=e.split("e"),o=a[0],l=a[1];if(o&&l){const r=Number(o);let i=Number(l);const u=i>0;u||(i=Math.abs(i));const s=v(r);return u?(s.integer+=i,i>s.fractional?s.fractional=0:s.fractional-=i):(s.fractional+=i,i>s.integer?s.integer=1:s.integer-=i),s}}return{integer:0,fractional:0}}function k(t,e,n,a){const o={previous:null,next:null};if(n!=null){const l=t-n,r=e-n-l;o.previous=Math.floor(Math.abs(100*r/l))}if(a!=null){const l=a-t,r=a-e-l;o.next=Math.floor(Math.abs(100*r/l))}return o}function Y(t,e={}){const n=t.slice(0),{tolerance:a=2,strictBounds:o=!1,indexes:l=n.map((r,i)=>i)}=e;l.sort(B);for(let r=0;r<l.length;r++){const i=l[r],u=n[i],s=i===0?null:n[i-1],c=i===n.length-1?null:n[i+1],d=v(u).fractional;if(d){let m,g=0,w=!1;for(;g<=d&&!w;){const b=M(u,g);m=o&&r===0?b[1]:b[0],w=S(u,m,s,c,a),g++}w&&(n[i]=m)}}return n}const Q={maximumFractionDigits:20};function T(t){return I(t,Q)}const q="<",F=">";function L(t,e,n,a){let o="";return e===0?o=`${q} `:e===n&&(o=`${F} `),o+(a?$(t,a):T(t))}const J=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function j(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(r=>r.type==="color");if(!e)return null;let n=null,a=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;n=e.stops[0].value,a=e.stops[e.stops.length-1].value}const o=n!=null&&a!=null?n+(a-n)/2:0,{getColor:l}=await h(async()=>{const{getColor:r}=await import("./index-B252NKV0.js").then(i=>i.y1);return{getColor:r}},__vite__mapDeps([0,1]));return l(e,o)??null}async function tt(t,e){const n=t.trailCap,a=t.trailWidth||1,o=e||await j(t)||t.color;return new C({cap:n,color:o,width:a})}function et(t){return t!=null&&typeof t=="object"&&"min"in t&&"max"in t}function D(t,e){var n,a;if(!e.field)return null;if("featureReduction"in t)switch((n=t.featureReduction)==null?void 0:n.type){case"cluster":case"binning":{const o=t.featureReduction.fields.find(({name:l})=>l.toLowerCase()===e.field.toLowerCase());return o&&"getField"in t?t.getField(o.onStatisticField):null}}return"getField"in t?(a=t.getField)==null?void 0:a.call(t,e.field):null}function G(t,e){var a,o,l;const n="popupTemplate"in t?(a=t.popupTemplate)==null?void 0:a.fieldInfos:null;if(n!=null&&n.length&&e)return(l=(o=n.find(r=>{var i;return((i=r.fieldName)==null?void 0:i.toLowerCase())===e.toLowerCase()}))==null?void 0:o.format)==null?void 0:l.dateFormat}function nt(t,e,n){var l,r,i,u;const a=D(t,e);if(!a||!E(a)&&!x(a))return null;let o=G(t,a.name);if(!o&&a.type==="date"){let s=0,c=0;e.stops?(s=((r=(l=e.stops)==null?void 0:l.at(0))==null?void 0:r.value)??s,c=((u=(i=e.stops)==null?void 0:i.at(-1))==null?void 0:u.value)??c):"minDataValue"in e&&"maxDataValue"in e&&(s=e.minDataValue??s,c=e.maxDataValue??c),o=c-s>2*V.days?"short-date":"short-date-short-time"}return{fieldType:a.type,format:o,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:n,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}}}const K=new f([64,64,64]);function y(t,e){const n=[],a=t.length-1;return t.length===5?n.push(0,2,4):n.push(0,a),t.map((o,l)=>n.includes(l)?L(o,l,a,e):null)}async function W(t,e,n){let a=!1,o=[],l=[];if(t.stops){const s=t.stops;o=s.map(c=>c.value),a=s.some(c=>!!c.label),a&&(l=s.map(c=>c.label))}const r=o[0],i=o[o.length-1];if(r==null&&i==null)return null;const u=a?null:y(o,n);return(await Promise.all(o.map(async(s,c)=>({value:s,color:t.type==="opacity"?await P(s,t,e):(await h(async()=>{const{getColor:d}=await import("./index-B252NKV0.js").then(m=>m.y1);return{getColor:d}},__vite__mapDeps([0,1]))).getColor(t,s),label:a?l[c]:(u==null?void 0:u[c])??""})))).reverse()}async function P(t,e,n){const a=new f(n??K),o=(await h(async()=>{const{getOpacity:l}=await import("./index-B252NKV0.js").then(r=>r.y1);return{getOpacity:l}},__vite__mapDeps([0,1]))).getOpacity(e,t);return o!=null&&(a.a=o),a}function ot(t){let e=!1,n=[],a=[];n=t.map(i=>i.value),e=t.some(i=>!!i.label),e&&(a=t.map(i=>i.label??""));const o=n[0],l=n[n.length-1];if(o==null&&l==null)return null;const r=e?null:y(n);return n.map((i,u)=>({value:i,color:Z(i,t),label:e?a[u]:(r==null?void 0:r[u])??""})).reverse()}function Z(t,e){const{startIndex:n,endIndex:a,weight:o}=H(t,e);if(n===a)return e[n].color;const l=f.blendColors(e[n].color,e[a].color,o);return new f(l)}function H(t,e){let n=0,a=e.length-1;return e.some((o,l)=>t<o.value?(a=l,!0):(n=l,!1)),{startIndex:n,endIndex:a,weight:(t-e[n].value)/(e[a].value-e[n].value)}}function at(t,e){let n=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((a,o)=>{o===0?n.push({value:e.max,color:new f(a.toColor),label:"high"}):n.push({value:null,color:new f(a.toColor),label:""}),o===t.colorRamps.length-1?n.push({value:e.min,color:new f(a.fromColor),label:"low"}):n.push({value:null,color:new f(a.fromColor),label:""})});else{let a,o;t&&t.type==="algorithmic"?(a=t.fromColor,o=t.toColor):(a=[0,0,0,1],o=[255,255,255,1]),n=[{value:e.max,color:new f(o),label:"high"},{value:e.min,color:new f(a),label:"low"}]}return n}function z(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(a=>{var o;return((o=a.color)==null?void 0:o.a)>0});let n=e.length-1;if(e[0]){const a=e[n];a&&a.ratio!==1&&(e.push(new N({ratio:1,color:a.color})),n++)}return e.map((a,o)=>{var r,i;let l="";return o===0?l=((r=t.legendOptions)==null?void 0:r.minLabel)||"low":o===n&&(l=((i=t.legendOptions)==null?void 0:i.maxLabel)||"high"),{color:a.color,label:l,ratio:a.ratio}}).reverse()}const lt=R("short-date");async function A(t,e,n){O(t,e,()=>[]).push(...n)}async function it(t){var n,a;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const o=t.visualVariables.filter(l=>l.type==="color");for(const l of o){const r=(await W(l)??[]).map(i=>i.color);await A(e,l.field||l.valueExpression,r)}}if(t.type==="heatmap"){const o=z(t).map(l=>l.color);await A(e,t.field||t.valueExpression,o)}else if(t.type==="pie-chart"){for(const o of t.attributes)await A(e,o.field||o.valueExpression,[o.color]);await A(e,"default",[(n=t==null?void 0:t.othersCategory)==null?void 0:n.color,p(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const o of t.attributes)await A(e,o.field||o.valueExpression,[o.color]);await A(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((a=t.authoringInfo)==null?void 0:a.type)==="predominance")for(const o of t.uniqueValueInfos??[])await A(e,o.value.toString(),[p(o.symbol,null)]);else{const o=(t.uniqueValueInfos??[]).map(s=>p(s.symbol,null)),{field:l,field2:r,field3:i,valueExpression:u}=t;(l||u)&&await A(e,l||u,o),r&&await A(e,r,o),i&&await A(e,i,o)}else if(t.type==="class-breaks"){const o=t.classBreakInfos.map(i=>p(i.symbol,null)),{field:l,valueExpression:r}=t;await A(e,l??r,o)}else t.type==="simple"&&await A(e,"default",[p(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await A(e,"default",[p(t.defaultSymbol,null)]),e.forEach((o,l)=>{const r=U(o.filter(Boolean),(i,u)=>JSON.stringify(i)===JSON.stringify(u));e.set(l,r)}),e}export{q as a,F as b,Z as c,ot as d,z as e,at as f,j as g,nt as h,v as i,W as j,k as l,et as m,tt as p,L as r,J as s,Y as u,lt as v,it as x};
