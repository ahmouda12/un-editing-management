const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chartUtilsAm5-D7wNdF4_.js","assets/index-DPJiPkbh.js","assets/index-HngaTkmj.css","assets/Theme-edv9kL3W.js","assets/Tooltip-COvI3888.js","assets/DefaultTheme-DA42VlNH.js","assets/calcite-icon-7wB1xzh2.js","assets/icon-DwdUDmXD.js","assets/dom-BlTj4jtE.js","assets/observers-DXQDxHJZ.js","assets/chartCommon-CNZgHiJV.js","assets/ResponsiveTheme-2N2ye8mw.js","assets/Button-DX-bp_7x.js","assets/ColorSet-ktRC30iD.js","assets/pieChart-BcnbdLW4.js","assets/Tick-hO3O8P6C.js","assets/xyChart-CWwSBe9_.js","assets/LineSeries-B891frIQ.js","assets/calcite-list-E2bqcYXp.js","assets/interactive-CUuALpv0.js","assets/resources4-DXHY1U7R.js","assets/utils3-exWydRL4.js","assets/loadable-CXsmssm6.js","assets/t9n-CeKm3gqL.js","assets/locale-CS3btv4w.js","assets/key-D63ExP77.js","assets/filter-yN6-jZOU.js","assets/debounce-BOqmhDXu.js","assets/input2-DvrCRwl9.js","assets/form-B4OwUu51.js","assets/label-C1Y8426B.js","assets/component-6CIDVndn.js","assets/Validation-nOlLLBIC.js","assets/input-j1u1wOBY.js","assets/input-message-C-NSbwGv.js","assets/progress-BrWM7Ubw.js","assets/loader-DPaOyEdE.js","assets/scrim-C6--6irQ.js","assets/calcite-list-item-BfYt6AQV.js","assets/action-ED8yfrZZ.js","assets/handle-jADsp4A6.js","assets/calcite-notice-B4prE6yM.js","assets/conditionalSlot-CaMpRMew.js","assets/openCloseComponent-C5H0O9Vb.js"])))=>i.map(i=>d[i]);
import{x as o,y as l,B as P,ty as Ct,io as B,iq as h,nb as at,tz as xt,cR as V,fs as k,b5 as Pe,ab as ce,tA as _e,tB as lt,lJ as dt,qX as $t,tC as ct,tD as ut,im as J,lK as G,tE as Z,s as Ue,g4 as Et,F as ee,sn as Ft,aU as Oe,aX as Me,gx as Tt,v as Rt,m0 as Lt,oi as pt,eh as ve,tF as Q,aE as ht,tG as je,tH as qe,tI as St,tJ as Be,tK as mt,tL as Vt,tM as Pt,_ as C,ip as ke,iy as Ne,mf as Se,tN as De,tO as We,i4 as Ot,tP as kt,ad as ft,tQ as Nt,tR as _t,tS as Dt,iE as He,tT as Xe,g1 as ye,eP as Wt,aS as Ht,eV as Xt,tU as zt,tV as Ze,tW as Yt,ny as Ut,tX as jt,bF as qt,tY as Bt,tZ as Zt,t_ as Qt,t$ as Ae,u0 as Kt,u1 as Jt,lL as Gt}from"./index-DPJiPkbh.js";import{a as ei}from"./uriUtils-C8IqP4Ns.js";import{e as ti}from"./a11yUtils-BChjGAWF.js";import{x as ii}from"./utils-Di5g0ZYb.js";import{s as Ce}from"./executeQueryJSON-BsORPFGP.js";import"./normalizeUtilsCommon-DTYpWx_K.js";import"./pbf-BAzJBNw5.js";import{r as si}from"./themeUtils-C3zvZbsE.js";import{e as yt}from"./throttle-jjSnxk80.js";let ae=class extends Ct{constructor(t){super(t),this.description=null,this.title=null}};o([l()],ae.prototype,"description",void 0),o([l()],ae.prototype,"title",void 0),ae=o([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ae);const ze=ae,xe="esri-feature-element-info",$e={base:xe,title:`${xe}__title`,description:`${xe}__description`};let te=class extends B{constructor(t,i){super(t,i),this.description=null,this.headingLevel=2,this.title=null}render(){return h("div",{class:$e.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:t}=this;return t?h(at,{class:$e.title,level:this.headingLevel},t):null}_renderDescription(){const{description:t}=this;return t?h("div",{class:$e.description,key:"description"},t):null}};o([l()],te.prototype,"description",void 0),o([l()],te.prototype,"headingLevel",void 0),o([l()],te.prototype,"title",void 0),te=o([P("esri.widgets.Feature.support.FeatureElementInfo")],te);const we=te,ri={base:"esri-feature-attachments"};let z=class extends B{constructor(t,i){super(t,i),this._featureElementInfo=null,this.attachmentsWidget=new xt,this.headingLevel=2,this.viewModel=new ze}initialize(){this._featureElementInfo=new we,this.addHandles([V(()=>{var t,i;return[(t=this.viewModel)==null?void 0:t.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),k),V(()=>this.viewModel,t=>this.attachmentsWidget.viewModel=t,k)])}destroy(){var t;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),(t=this._featureElementInfo)==null||t.destroy()}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get displayType(){return this.attachmentsWidget.displayType}set displayType(t){this.attachmentsWidget.displayType=t}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var i;const{attachmentsWidget:t}=this;return h("div",{class:ri.base},(i=this._featureElementInfo)==null?void 0:i.render(),t==null?void 0:t.render())}_setupFeatureElementInfo(){var r;const{description:t,title:i,headingLevel:s}=this;(r=this._featureElementInfo)==null||r.set({description:t,title:i,headingLevel:s})}};o([l({readOnly:!0})],z.prototype,"attachmentsWidget",void 0),o([l()],z.prototype,"description",null),o([l()],z.prototype,"displayType",null),o([l()],z.prototype,"graphic",null),o([l()],z.prototype,"headingLevel",void 0),o([l()],z.prototype,"title",null),o([l({type:ze})],z.prototype,"viewModel",void 0),z=o([P("esri.widgets.Feature.FeatureAttachments")],z);const ni=z;let q=class extends ce{constructor(t){super(t),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(V(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},k))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:t,graphic:i,destroyer:s}=this;t&&i&&(_e(s,{graphic:i}).catch(()=>null),this._set("created",null))}async _createContent(t){const i=this.graphic;if(!i||!t)return;const s=_e(t,{graphic:i}).catch(()=>null);this._loadingPromise=s,this.notifyChange("state");const r=await s;s===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};o([l({readOnly:!0})],q.prototype,"created",void 0),o([l()],q.prototype,"creator",void 0),o([l()],q.prototype,"destroyer",void 0),o([l({type:Pe})],q.prototype,"graphic",void 0),o([l({readOnly:!0})],q.prototype,"state",null),q=o([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],q);const ge=q,Ee="esri-feature-content",Fe={base:Ee,loaderContainer:`${Ee}__loader-container`,loader:`${Ee}__loader`};let ie=class extends B{constructor(t,i){super(t,i),this.viewModel=null,this._addTargetToAnchors=s=>{Array.from(s.querySelectorAll("a")).forEach(r=>{lt(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){var t;return(t=this.viewModel)==null?void 0:t.creator}set creator(t){this.viewModel&&(this.viewModel.creator=t)}get graphic(){var t;return(t=this.viewModel)==null?void 0:t.graphic}set graphic(t){this.viewModel&&(this.viewModel.graphic=t)}render(){var i;const t=(i=this.viewModel)==null?void 0:i.state;return h("div",{class:Fe.base},t==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return h("div",{class:Fe.loaderContainer,key:"loader"},h("div",{class:Fe.loader}))}_renderCreated(){var i;const t=(i=this.viewModel)==null?void 0:i.created;return t?t instanceof HTMLElement?h("div",{afterCreate:this._attachToNode,bind:t,key:t}):dt(t)?h("div",{key:t},!t.destroyed&&t.render()):h("div",{afterCreate:this._addTargetToAnchors,innerHTML:t,key:t}):null}_attachToNode(t){const i=this;t.appendChild(i)}};o([l()],ie.prototype,"creator",null),o([l()],ie.prototype,"graphic",null),o([l({type:ge})],ie.prototype,"viewModel",void 0),ie=o([P("esri.widgets.Feature.FeatureContent")],ie);const he=ie;let U=class extends ce{constructor(t){super(t),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:t,fieldInfos:i}=this,s=[];return i==null||i.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const n=r.clone();n.label=ut(n,t),s.push(n)}),s}};o([l()],U.prototype,"attributes",void 0),o([l({type:[$t]})],U.prototype,"expressionInfos",void 0),o([l()],U.prototype,"description",void 0),o([l({type:[ct]})],U.prototype,"fieldInfos",void 0),o([l({readOnly:!0})],U.prototype,"formattedFieldInfos",null),o([l()],U.prototype,"title",void 0),U=o([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],U);const Ie=U,ue="esri-feature-fields",pe={base:ue,fieldHeader:`${ue}__field-header`,fieldData:`${ue}__field-data`,fieldDataDate:`${ue}__field-data--date`};let W=class extends B{constructor(t,i){super(t,i),this._featureElementInfo=null,this.viewModel=new Ie,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new we,this.addHandles(V(()=>{var t,i;return[(t=this.viewModel)==null?void 0:t.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),k))}destroy(){var t;(t=this._featureElementInfo)==null||t.destroy()}get attributes(){return this.viewModel.attributes}set attributes(t){this.viewModel.attributes=t}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(t){this.viewModel.expressionInfos=t}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(t){this.viewModel.fieldInfos=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var t;return h("div",{class:pe.base},(t=this._featureElementInfo)==null?void 0:t.render(),this._renderFields())}_renderFieldInfo(t,i){const{attributes:s}=this.viewModel,r=t.fieldName,n=t.label||r,a=s?s[r]==null?"":s[r]:"",c=!(!t.format||!t.format.dateFormat),d=typeof a=="number"&&!c?this._forceLTR(a):ei(this.messagesURIUtils,a),p={[pe.fieldDataDate]:c};return h("tr",{key:`fields-element-info-row-${r}-${i}`},h("th",{class:pe.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${r}-${i}`}),h("td",{class:this.classes(pe.fieldData,p),innerHTML:d,key:`fields-element-info-row-data-${r}-${i}`}))}_renderFields(){const{formattedFieldInfos:t}=this.viewModel;return t!=null&&t.length?h("table",{class:G.table,summary:this.messages.fieldsSummary},h("tbody",null,t.map((i,s)=>this._renderFieldInfo(i,s)))):null}_setupFeatureElementInfo(){var s;const{description:t,title:i}=this;(s=this._featureElementInfo)==null||s.set({description:t,title:i})}_forceLTR(t){return`&lrm;${t}`}};o([l()],W.prototype,"attributes",null),o([l()],W.prototype,"description",null),o([l()],W.prototype,"expressionInfos",null),o([l()],W.prototype,"fieldInfos",null),o([l()],W.prototype,"title",null),o([l({type:Ie,nonNullable:!0})],W.prototype,"viewModel",void 0),o([l(),J("esri/widgets/Feature/t9n/Feature")],W.prototype,"messages",void 0),o([l(),J("esri/widgets/support/t9n/uriUtils")],W.prototype,"messagesURIUtils",void 0),W=o([P("esri.widgets.Feature.FeatureFields")],W);const gt=W,oi="esri.widgets.Feature.support.relatedFeatureUtils",Qe=()=>Oe.getLogger(oi),Ke=new Map;function me(e){if(!Z(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function ai(e,t){if(!t.relationships)return null;let i=null;const{relationships:s}=t;return s.some(r=>r.id===parseInt(e,10)&&(i=r,!0)),i}function li({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:s,id:r})=>`${s}`===i&&r===(e==null?void 0:e.id))??null}function di(e,t){const i=t.toLowerCase();for(const s in e)if(s.toLowerCase()===i)return e[s];return null}function ci(e,t){const i=ai(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function ui(e,t){if(!t||!e)return;const{features:i,statsFeatures:s}=e,r=i==null?void 0:i.value;t.relatedFeatures=r?r.features:[];const n=s==null?void 0:s.value;t.relatedStatsFeatures=n?n.features:[]}function pi(e,t,i,s){var n;const r=new Lt;return r.outFields=["*"],r.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),r.objectIds=[e.attributes[i.objectIdField]],((n=i.queryRelatedFeatures)==null?void 0:n.call(i,r,s))??Promise.resolve({})}function hi(e,t,i){let s=0;const r=[];for(;s<t.length;)r.push(`${e} IN (${t.slice(s,i+s)})`),s+=i;return r.join(" OR ")}function mi(e){return e?pt(e):void 0}function fi(e){return e?pt(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}async function _i(e,t,i,s){const r=i.layerId.toString(),{layerInfo:n,relation:a,relatedFields:c,outStatistics:d,url:p,sourceSpatialReference:u}=t,m=mi(c),f=fi(d);if(!n||!a)return null;const _=li({originRelationship:a,relationships:n.relationships,layerId:r});if(_!=null&&_.relationshipTableId&&_.keyFieldInRelationshipTable){const g=(await pi(e,_,i,s))[e.attributes[i.objectIdField]];if(!g)return null;const w=g.features.map(v=>v.attributes[n.objectIdField]);if(f!=null&&f.length&&n.supportsStatistics){const v=new Me;v.where=hi(n.objectIdField,w,1e3),v.outFields=m,v.outStatistics=f,v.sourceSpatialReference=u;const I={features:Promise.resolve(g),statsFeatures:Ce(p,v)};return ee(I)}}const y=_==null?void 0:_.keyField;if(y){const g=Tt(Ii(n.fields,y)),w=di(e.attributes,a.keyField),v=g?`${y}=${w}`:`${y}='${w}'`,I=Ce(p,new Me({where:v,outFields:m,sourceSpatialReference:u}),s),M=f!=null&&f.length&&n.supportsStatistics?Ce(p,new Me({where:v,outFields:m,outStatistics:f,sourceSpatialReference:u}),s):null,x={features:I};return M&&(x.statsFeatures=M),ee(x)}return null}function yi(e,t){return Rt(e,{query:{f:"json"},signal:t==null?void 0:t.signal})}function gi({relatedInfos:e,layer:t},i){const s={};return e.forEach((r,n)=>{const{relation:a}=r;if(!a){const m=new Ue("relation-required","A relation is required on a layer to retrieve related records.");throw Qe().error(m),m}const{relatedTableId:c}=a;if(typeof c!="number"){const m=new Ue("A related table ID is required on a layer to retrieve related records.");throw Qe().error(m),m}const d=`${t.url}/${c}`,p=Ke.get(d),u=p??yi(d);p||Ke.set(d,u),s[n]=u}),Et(ee(s),i)}function vi({graphic:e,relatedInfos:t,layer:i},s){const r={};return t.forEach((n,a)=>{n.layerInfo&&(r[a]=_i(e,n,i,s))}),ee(r)}function wi({relatedInfo:e,fieldName:t,fieldInfo:i}){var s,r;if((s=e.relatedFields)==null||s.push(t),i.statisticType){const n=new Ft({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});(r=e.outStatistics)==null||r.push(n)}}function Ii(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const Je={chartAnimation:!0};let E=class extends ce{constructor(t){super(t),this.abilities={...Je},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(t){return{...Je,...t}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(t){this._setContentElementMedia(t)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(t){const{formattedMediaInfoCount:i}=this,s=(t+i)%i;this.activeMediaInfoIndex=s}_pageContentElementMedia(t){const{activeMediaInfoIndex:i}=this,s=i+t;this._setContentElementMedia(s)}_formatMediaInfos(){const{mediaInfos:t,layer:i}=this,s=this.attributes??{},r=this.formattedAttributes??{},n=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return(t==null?void 0:t.map(c=>{const d=c==null?void 0:c.clone();if(!d)return null;if(d.title=Q({attributes:s,fieldInfoMap:a,globalAttributes:r,expressionAttributes:n,layer:i,text:d.title}),d.caption=Q({attributes:s,fieldInfoMap:a,globalAttributes:r,expressionAttributes:n,layer:i,text:d.caption}),d.altText=Q({attributes:s,fieldInfoMap:a,globalAttributes:r,expressionAttributes:n,layer:i,text:d.altText}),d.type==="image"){const{value:p}=d;return this._setImageValue({value:p,formattedAttributes:r,layer:i}),d.value.sourceURL?d:void 0}if(d.type==="pie-chart"||d.type==="line-chart"||d.type==="column-chart"||d.type==="bar-chart"){const{value:p}=d;return this._setChartValue({value:p,chartType:d.type,attributes:s,formattedAttributes:r,layer:i,expressionAttributes:n}),d}return null}).filter(ht))??[]}_setImageValue(t){const i=this.fieldInfoMap??new Map,{value:s,formattedAttributes:r,layer:n}=t,{linkURL:a,sourceURL:c}=s;if(c){const d=je(c,n);s.sourceURL=qe({formattedAttributes:r,template:d,fieldInfoMap:i})}if(a){const d=je(a,n);s.linkURL=qe({formattedAttributes:r,template:d,fieldInfoMap:i})}}_setChartValue(t){const{value:i,attributes:s,formattedAttributes:r,chartType:n,layer:a,expressionAttributes:c}=t,{popupTemplate:d,relatedInfos:p}=this,{fields:u,normalizeField:m}=i,f=a;if(i.fields=St(u,f),m&&(i.normalizeField=Be(m,f)),!u.some(y=>!!(r[y]!=null||Z(y)&&(p!=null&&p.size))))return;const _=(d==null?void 0:d.fieldInfos)??[];u.forEach((y,g)=>{var I;const w=(I=i.colors)==null?void 0:I[g];if(Z(y))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:_,fieldName:y,formattedAttributes:r,chartType:n,value:i,color:w})]);const v=this._getChartOption({value:i,attributes:s,chartType:n,formattedAttributes:r,expressionAttributes:c,fieldName:y,fieldInfos:_,color:w});i.series.push(v)})}_getRelatedChartInfos(t){var y;const{fieldInfos:i,fieldName:s,formattedAttributes:r,chartType:n,value:a,color:c}=t,d=[],p=me(s),u=p&&((y=this.relatedInfos)==null?void 0:y.get(p.layerId.toString()));if(!u)return d;const{relatedFeatures:m,relation:f}=u;if(!f||!m)return d;const{cardinality:_}=f;return m.forEach(g=>{const{attributes:w}=g;w&&Object.keys(w).forEach(v=>{v===p.fieldName&&d.push(this._getChartOption({value:a,attributes:w,formattedAttributes:r,fieldName:s,chartType:n,relatedFieldName:v,hasMultipleRelatedFeatures:(m==null?void 0:m.length)>1,fieldInfos:i,color:c}))})}),_==="one-to-many"||_==="many-to-many"?d:[d[0]]}_getTooltip({label:t,value:i,chartType:s}){return s==="pie-chart"?`${t}`:`${t}: ${i}`}_getChartOption(t){var X;const{value:i,attributes:s,formattedAttributes:r,expressionAttributes:n,fieldName:a,relatedFieldName:c,fieldInfos:d,chartType:p,hasMultipleRelatedFeatures:u,color:m}=t,f=this.layer,_=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:g}=i,w=y?Z(y)?s[me(y).fieldName]:s[y]:null,v=mt(a)&&n&&n[a]!==void 0?n[a]:c&&s[c]!==void 0?s[c]:s[a]!==void 0?s[a]:r[a],I=new Vt({fieldName:a,color:m,value:v===void 0?null:v&&w?v/w:v});if(Z(a)){const D=_.get(a.toLowerCase()),se=g&&_.get(g.toLowerCase()),be=(D==null?void 0:D.fieldName)??a,re=u&&g?me(g).fieldName:(se==null?void 0:se.fieldName)??g,Mt=u&&re?s[re]:r[re]??(D==null?void 0:D.label)??(D==null?void 0:D.fieldName)??c,At=u&&c?s[c]:r[be];return I.tooltip=this._getTooltip({label:Mt,value:At,chartType:p}),I}const M=Pt(d,a),x=Be(a,f),N=g&&r[g]!==void 0?r[g]:ut(M||new ct({fieldName:x}),(X=this.popupTemplate)==null?void 0:X.expressionInfos),H=r[x];return I.tooltip=this._getTooltip({label:N,value:H,chartType:p}),I}};o([l()],E.prototype,"abilities",void 0),o([ve("abilities")],E.prototype,"castAbilities",null),o([l()],E.prototype,"activeMediaInfoIndex",void 0),o([l({readOnly:!0})],E.prototype,"activeMediaInfo",null),o([l()],E.prototype,"attributes",void 0),o([l()],E.prototype,"description",void 0),o([l()],E.prototype,"fieldInfoMap",void 0),o([l()],E.prototype,"formattedAttributes",void 0),o([l()],E.prototype,"expressionAttributes",void 0),o([l({readOnly:!0})],E.prototype,"formattedMediaInfos",null),o([l()],E.prototype,"isAggregate",void 0),o([l()],E.prototype,"layer",void 0),o([l({readOnly:!0})],E.prototype,"formattedMediaInfoCount",null),o([l()],E.prototype,"mediaInfos",void 0),o([l()],E.prototype,"popupTemplate",void 0),o([l()],E.prototype,"relatedInfos",void 0),o([l()],E.prototype,"title",void 0),E=o([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],E);const K=E,$="esri-feature-media",R={base:$,mediaContainer:`${$}__container`,mediaItemContainer:`${$}__item-container`,mediaItem:`${$}__item`,mediaItemText:`${$}__item-text`,mediaItemTitle:`${$}__item-title`,mediaItemCaption:`${$}__item-caption`,mediaNavigation:`${$}__item-navigation`,mediaPagination:`${$}__pagination`,mediaPaginationText:`${$}__pagination-text`,mediaPrevious:`${$}__previous`,mediaPreviousIconLTR:`${$}__previous-icon`,mediaPreviousIconRTL:`${$}__previous-icon--rtl`,mediaNext:`${$}__next`,mediaNextIconLTR:`${$}__next-icon`,mediaNextIconRTL:`${$}__next-icon--rtl`,mediaChart:`${$}__chart`,mediaPaginationButton:`${$}__pagination-button`,mediaPaginationIcon:`${$}__pagination-icon`,mediaChartRendered:`${$}__chart--rendered`},Te=15,j="category",ne="value",bi="rgba(50, 50, 50, 1)",Mi=250,Ai=500,Ci=200;let L=class extends B{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new K,this.messages=null,this._disposeChart=i=>{var s;(s=this._chartRootMap.get(i))==null||s.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{const{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;const{createRoot:n}=await C(()=>import("./chartUtilsAm5-D7wNdF4_.js").then(c=>c.c),__vite__mapDeps([0,1,2,3,4,5])),a=await n(i);this._chartRootMap.set(i,a),this._renderChart({mediaInfo:r.activeMediaInfo,root:a})}}initialize(){this._featureElementInfo=new we,this.addHandles([V(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),k),V(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),k)])}loadDependencies(){return ke({icon:()=>C(()=>import("./calcite-icon-7wB1xzh2.js"),__vite__mapDeps([6,7,1,2,8,9]))})}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return h("div",{bind:this,class:R.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?h("div",{class:R.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),h("div",{class:R.mediaNavigation},i,e>1?h("div",{class:R.mediaPagination},this._renderMediaPageButton("previous"),h("span",{class:R.mediaPaginationText},Ne(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e&&e.title?h("div",{class:R.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?h("div",{class:R.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?h("div",{class:R.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:n,altText:a,title:c,type:d}=e,{sourceURL:p,linkURL:u}=r,m=lt(u??void 0)?"_blank":"_self",f=m==="_blank"?"noreferrer":"",_=n?t:null,y=_?_.timestamp:0,g=_?_.sourceURL:p,w=h("img",{alt:a||c,key:`media-${d}-${i}-${s}-${y}`,src:g??void 0});return(u?h("a",{href:u,rel:f,target:m,title:c},w):null)??w}_renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return h("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:R.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?h("div",{class:R.mediaItemContainer,key:"media-container"},h("div",{class:R.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,s=t?"chevron-left":"chevron-right",r=t?"media-previous":"media-next",n=t?this._previous:this._next;return h("button",{"aria-label":i,bind:this,class:R.mediaPaginationButton,key:r,onclick:n,tabIndex:0,title:i,type:"button"},h("calcite-icon",{class:R.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){var i;const{description:e,title:t}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:e,layer:t}=this.viewModel;return e&&(t!=null&&t.featureReduction)&&"renderer"in t.featureReduction?t.featureReduction.renderer:t==null?void 0:t.renderer}async _getSeriesColors(e){const{colorAm5:t}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13])),i=new Map;return e.forEach(s=>{s.color&&i.set(s,t(s.color.toCss(!0)))}),i}async _getRendererColors(){const{colorAm5:e}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13])),t=new Map,i=this._getRenderer(),s="default";if(!i)return t;const r=await ii(i);return r.delete(s),Array.from(r.values()).every(n=>(n==null?void 0:n.length)===1)&&Array.from(r.keys()).forEach(n=>{var c,d;const a=(d=(c=r.get(n))==null?void 0:c[0])==null?void 0:d.toCss(!0);a&&t.set(n,e(a))}),t}_handleMediaKeyup(e){const{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!ti()}_getChartAnimationMS(){return this._canAnimateChart()?Mi:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Ai:0}async _renderChart(e){const{root:t,mediaInfo:i}=e,{value:s,type:r}=i,{ResponsiveThemeAm5:n,DarkThemeAm5:a,AnimatedThemeAm5:c,ColorSetAm5:d,ThemeAm5:p,esriChartColorSet:u}=await C(async()=>{const{ResponsiveThemeAm5:M,DarkThemeAm5:x,AnimatedThemeAm5:N,ColorSetAm5:H,ThemeAm5:X,esriChartColorSet:D}=await import("./chartCommon-CNZgHiJV.js");return{ResponsiveThemeAm5:M,DarkThemeAm5:x,AnimatedThemeAm5:N,ColorSetAm5:H,ThemeAm5:X,esriChartColorSet:D}},__vite__mapDeps([10,3,1,2,11,12,4,13])),m=p.new(t);m.rule("ColorSet").set("colors",u),m.rule("ColorSet").set("reuse",!0);const f=[n.new(t),m];si()&&f.push(a.new(t)),this._canAnimateChart()&&f.push(c.new(t)),t.setThemes(f);const _=await this._getRendererColors(),y=await this._getSeriesColors(s.series),g=d.new(t,{}),w=y.get(s.series[0]),v=w?{lineSettings:{stroke:w}}:void 0,I=s.series.map((M,x)=>{const N=y.get(M)||_.get(M.fieldName)||g.getIndex(x);return{[j]:M.tooltip,[ne]:M.value,columnSettings:{fill:N,stroke:N},...v}}).filter(M=>r!=="pie-chart"||M.value!=null&&M.value>0);r==="pie-chart"?this._createPieChart(e,I):this._createXYChart(e,I)}_getDirection(){return Se(this.container)?"rtl":"ltr"}_isInversed(){return!!Se(this.container)}async _customizeChartTooltip(e,t="horizontal"){var s;const{colorAm5:i}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13]));e.setAll({pointerOrientation:t}),(s=e.get("background"))==null||s.setAll({stroke:i(bi)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Ci})}async _createPieChart(e,t){const{TooltipAm5:i}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13])),{PieChartAm5:s,PieSeriesAm5:r}=await C(async()=>{const{PieChartAm5:y,PieSeriesAm5:g}=await import("./pieChart-BcnbdLW4.js");return{PieChartAm5:y,PieSeriesAm5:g}},__vite__mapDeps([14,1,2,15,3,13,5])),{mediaInfo:n,root:a}=e,{title:c}=n,d=5,p=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",u=a.container.children.push(s.new(a,{ariaLabel:p,focusable:!0,paddingBottom:d,paddingTop:d,paddingLeft:d,paddingRight:d})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=i.new(a,{labelText:m}),_=u.series.push(r.new(a,{name:c,valueField:ne,categoryField:j,tooltip:f}));_.ticks.template.set("forceHidden",!0),_.labels.template.set("forceHidden",!0),_.slices.template.states.create("active",{shiftRadius:d}),this._customizeChartTooltip(f),_.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),_.data.setAll(t),_.appear(this._getChartSeriesAnimationMS()),u.appear(this._getChartAnimationMS()),u.root.dom.classList.toggle(R.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}async _createColumnChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13])),{CategoryAxisAm5:n,AxisRendererXAm5:a,ValueAxisAm5:c,AxisRendererYAm5:d,ColumnSeriesAm5:p}=await C(async()=>{const{CategoryAxisAm5:M,AxisRendererXAm5:x,ValueAxisAm5:N,AxisRendererYAm5:H,ColumnSeriesAm5:X}=await import("./xyChart-CWwSBe9_.js");return{CategoryAxisAm5:M,AxisRendererXAm5:x,ValueAxisAm5:N,AxisRendererYAm5:H,ColumnSeriesAm5:X}},__vite__mapDeps([16,17,3,1,2,13,5,15,12])),{mediaInfo:u,root:m}=t,{value:f,title:_}=u;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(n.new(m,{renderer:a.new(m,{inversed:this._isInversed()}),categoryField:j}));y.get("renderer").labels.template.setAll({forceHidden:!0});const g=e.yAxes.push(c.new(m,{renderer:d.new(m,{inside:!1}),min:this._getMinSeriesValue(f.series)}));g.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryX}",v=s.new(m,{labelText:w}),I=e.series.push(p.new(m,{name:_,xAxis:y,yAxis:g,valueYField:ne,categoryXField:j,tooltip:v}));this._customizeChartTooltip(v),I.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),f.series.length>Te&&e.set("scrollbarX",r.new(m,{orientation:"horizontal"})),y.data.setAll(i),I.data.setAll(i),I.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13])),{CategoryAxisAm5:n,AxisRendererXAm5:a,ValueAxisAm5:c,AxisRendererYAm5:d,ColumnSeriesAm5:p}=await C(async()=>{const{CategoryAxisAm5:M,AxisRendererXAm5:x,ValueAxisAm5:N,AxisRendererYAm5:H,ColumnSeriesAm5:X}=await import("./xyChart-CWwSBe9_.js");return{CategoryAxisAm5:M,AxisRendererXAm5:x,ValueAxisAm5:N,AxisRendererYAm5:H,ColumnSeriesAm5:X}},__vite__mapDeps([16,17,3,1,2,13,5,15,12])),{mediaInfo:u,root:m}=t,{value:f,title:_}=u;e.setAll({wheelX:"panY",wheelY:"zoomY"});const y=e.yAxes.push(n.new(m,{renderer:d.new(m,{inversed:!0}),categoryField:j}));y.get("renderer").labels.template.setAll({forceHidden:!0});const g=e.xAxes.push(c.new(m,{renderer:a.new(m,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(f.series)}));g.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryY}",v=s.new(m,{labelText:w}),I=e.series.push(p.new(m,{name:_,xAxis:g,yAxis:y,valueXField:ne,categoryYField:j,tooltip:v}));this._customizeChartTooltip(v,"vertical"),I.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),f.series.length>Te&&e.set("scrollbarY",r.new(m,{orientation:"vertical"})),y.data.setAll(i),I.data.setAll(i),I.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,i){var x,N,H;const{TooltipAm5:s,ScrollbarAm5:r}=await C(()=>import("./chartCommon-CNZgHiJV.js"),__vite__mapDeps([10,3,1,2,11,12,4,13])),{CategoryAxisAm5:n,AxisRendererXAm5:a,ValueAxisAm5:c,AxisRendererYAm5:d,LineSeriesAm5:p}=await C(async()=>{const{CategoryAxisAm5:X,AxisRendererXAm5:D,ValueAxisAm5:se,AxisRendererYAm5:be,LineSeriesAm5:re}=await import("./xyChart-CWwSBe9_.js");return{CategoryAxisAm5:X,AxisRendererXAm5:D,ValueAxisAm5:se,AxisRendererYAm5:be,LineSeriesAm5:re}},__vite__mapDeps([16,17,3,1,2,13,5,15,12])),{root:u,mediaInfo:m}=t,{value:f,title:_}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(n.new(u,{renderer:a.new(u,{inversed:this._isInversed()}),categoryField:j}));y.get("renderer").labels.template.setAll({forceHidden:!0});const g=e.yAxes.push(c.new(u,{renderer:d.new(u,{inside:!1}),min:this._getMinSeriesValue(f.series)}));g.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryX}",v=(N=(x=i[0])==null?void 0:x.lineSettings)==null?void 0:N.stroke,I=s.new(u,{getFillFromSprite:!v,labelText:w});v&&((H=I.get("background"))==null||H.setAll({fill:v}));const M=e.series.push(p.new(u,{name:_,xAxis:y,yAxis:g,valueYField:ne,categoryXField:j,tooltip:I}));M.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(I,"vertical"),f.series.length>Te&&e.set("scrollbarX",r.new(u,{orientation:"horizontal"})),y.data.setAll(i),M.data.setAll(i),M.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){const{XYChartAm5:i,XYCursorAm5:s}=await C(()=>import("./xyChart-CWwSBe9_.js"),__vite__mapDeps([16,17,3,1,2,13,5,15,12])),{root:r,mediaInfo:n}=e,{type:a}=n,c=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",d=r.container.children.push(i.new(r,{ariaLabel:c,focusable:!0,panX:!0,panY:!0}));d.set("cursor",s.new(r,{})),a==="column-chart"&&await this._createColumnChart(d,e,t),a==="bar-chart"&&await this._createBarChart(d,e,t),a==="line-chart"&&await this._createLineChart(d,e,t),d.root.dom.classList.toggle(R.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const s=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[s,r=""]=e.split("#");return`${s}${i}timestamp=${t}${r?"#":""}${r}`}};o([l()],L.prototype,"_refreshIntervalInfo",void 0),o([l()],L.prototype,"attributes",null),o([l()],L.prototype,"activeMediaInfoIndex",null),o([l()],L.prototype,"description",null),o([l()],L.prototype,"fieldInfoMap",null),o([l()],L.prototype,"layer",null),o([l()],L.prototype,"mediaInfos",null),o([l()],L.prototype,"popupTemplate",null),o([l()],L.prototype,"relatedInfos",null),o([l()],L.prototype,"title",null),o([l({type:K})],L.prototype,"viewModel",void 0),o([l(),J("esri/widgets/Feature/t9n/Feature")],L.prototype,"messages",void 0),L=o([P("esri.widgets.Feature.FeatureMedia")],L);const vt=L,xi="esri.widgets.Feature.support.arcadeFeatureUtils",Ge=()=>Oe.getLogger(xi);function $i(e){return typeof e=="string"?De(We(e)):Array.isArray(e)?Ei(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?Fi(e):e}function Ei(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?De(We(t)):t}</li>`).join("")}</ul>`}function Fi(e){const t=e.keys().map(i=>{const s=e.field(i);return`<tr><th>${i}</th><td>${typeof s=="string"?De(We(s)):s}</td></tr>`}).join("");return`<table class="${G.table}">${t}</table>`}function wt(){return C(()=>import("./index-DPJiPkbh.js").then(e=>e.y9),__vite__mapDeps([1,2]))}function Ti(e){return"createQuery"in e&&"queryFeatures"in e}async function Ri({graphic:e,view:t,options:i}){const{isAggregate:s,layer:r}=e;if(!s||!r||(t==null?void 0:t.type)!=="2d")return[];const n=await t.whenLayerView(r);if(!Ti(n))return[];const a=n.createQuery(),c=e.getObjectId();a.aggregateIds=c!=null?[c]:[];const{features:d}=await n.queryFeatures(a,i);return d}function Li({layer:e,aggregatedFeatures:t,interceptor:i}){const{fields:s,objectIdField:r,geometryType:n,spatialReference:a,displayField:c}=e;return new Ot({fields:s,objectIdField:r,geometryType:n,spatialReference:a,displayField:c,interceptor:i,...e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null,source:t})}async function It({expressionInfo:e,arcade:t,interceptor:i,spatialReference:s,map:r,graphic:n,location:a,view:c,options:d}){var M;if(!(e!=null&&e.expression))return null;const{isAggregate:p}=n,u=(n.sourceLayer||n.layer)??void 0,m=p?"feature-reduction-popup":"popup",f=t.createArcadeProfile(m),_=t.createArcadeExecutor(e.expression,f).catch(x=>Ge().error("arcade-executor-error",{error:x,expressionInfo:e})),[y,g]=await Promise.all([Ri({graphic:n,view:c,options:d}),_]);if(!g)return null;const w=m==="feature-reduction-popup"?Li({layer:u,aggregatedFeatures:y,interceptor:i}):void 0,v={...m==="feature-reduction-popup"?{$aggregatedFeatures:w}:{$datastore:u==null?void 0:u.url,$layer:(u==null?void 0:u.type)==="feature"||(u==null?void 0:u.type)==="subtype-sublayer"?u:(u==null?void 0:u.type)==="scene"&&u.associatedLayer!=null?u.associatedLayer:void 0,$map:r,$userInput:a,$graph:(u==null?void 0:u.type)==="knowledge-graph-sublayer"?(M=u==null?void 0:u.parentCompositeLayer)==null?void 0:M.knowledgeGraph:void 0},$feature:n},I={abortSignal:(d==null?void 0:d.signal)??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:s??void 0,timeZone:c==null?void 0:c.timeZone};return await g.executeAsync(v,I).catch(x=>Ge().error("arcade-execution-error",{error:x,graphic:n,expressionInfo:e})).finally(()=>w==null?void 0:w.destroy())}async function Si({expressionInfos:e,spatialReference:t,graphic:i,interceptor:s,map:r,view:n,location:a,options:c}){if(!(e!=null&&e.length))return{};const d=await wt(),p={};for(const f of e)p[`expression/${f.name}`]=It({expressionInfo:f,arcade:d,interceptor:s,spatialReference:t,map:r,graphic:i,location:a,view:n,options:c});const u=await ee(p),m={};for(const f in u)m[f]=$i(u[f].value);return m}const Vi=1;let O=class extends ce{constructor(t){super(t),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var r,n;const i=(r=this.contentElement)==null?void 0:r.type;(n=this.contentElementViewModel)==null||n.destroy();const s=i==="fields"?new Ie:i==="media"?new K:i==="text"?new ge:null;this._set("contentElementViewModel",s)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=yt(this._compile,Vi,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:s,interceptor:r,spatialReference:n,map:a,location:c,view:d,_abortController:p}=this;if(!i||!s)return void this._set("contentElement",null);const u=await wt();if(p!==this._abortController)return;const m=await It({arcade:u,expressionInfo:i,graphic:s,location:c,interceptor:r,map:a,spatialReference:n,view:d});if(!m||m.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const f=await m.castAsJsonAsync(p==null?void 0:p.signal),_=f==null?void 0:f.type,y=_==="media"?Nt.fromJSON(f):_==="text"?_t.fromJSON(f):_==="fields"?Dt.fromJSON(f):null;this._set("contentElement",y)},this.addHandles([V(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),k),V(()=>[this.contentElement],()=>this._createVM(),k)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var t;this._cancelQuery(),(t=this.contentElementViewModel)==null||t.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){const{_abortController:t,contentElement:i,contentElementViewModel:s}=this;return t?"loading":i||s?"ready":"disabled"}get map(){var t;return((t=this.view)==null?void 0:t.map)??null}set map(t){this._override("map",t)}};o([l()],O.prototype,"_abortController",void 0),o([l({type:kt})],O.prototype,"expressionInfo",void 0),o([l({type:Pe})],O.prototype,"graphic",void 0),o([l({readOnly:!0})],O.prototype,"contentElement",void 0),o([l({readOnly:!0})],O.prototype,"contentElementViewModel",void 0),o([l()],O.prototype,"interceptor",void 0),o([l({type:ft})],O.prototype,"location",void 0),o([l()],O.prototype,"spatialReference",null),o([l({readOnly:!0})],O.prototype,"state",null),o([l()],O.prototype,"map",null),o([l()],O.prototype,"view",void 0),O=o([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],O);const Ye=O,Re="esri-feature",Le={base:`${Re}-expression`,loadingSpinnerContainer:`${Re}__loading-container`,spinner:`${Re}__loading-spinner`};let fe=class extends B{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new Ye}initialize(){this.addHandles(V(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),k))}destroy(){this._destroyContentWidget()}render(){var t;const{state:e}=this.viewModel;return h("div",{class:Le.base},e==="loading"?this._renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_renderLoading(){return h("div",{class:Le.loadingSpinnerContainer,key:"loading-container"},h("span",{class:this.classes(He.loadingIndicator,G.rotating,Le.spinner)}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const s=e?i==="fields"?new gt({viewModel:e}):i==="media"?new vt({viewModel:e}):i==="text"?new he({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};o([l({type:Ye})],fe.prototype,"viewModel",void 0),fe=o([P("esri.widgets.Feature.FeatureExpression")],fe);const Pi=fe,le="esri-feature",oe=`${le}-relationship`,Y={base:oe,listContainer:`${oe}__list`,listItem:`${oe}__list-item`,listItemHidden:`${oe}__list-item--hidden`,listContainerQuerying:`${oe}__list--querying`,featureObserver:`${le}__feature-observer`,stickySpinnerContainer:`${le}__sticky-loading-container`,loadingSpinnerContainer:`${le}__loading-container`,spinner:`${le}__loading-spinner`},et={title:!0,description:!0};let S=class extends B{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Xe,this.messages=null,this.messagesCommon=null,this.visibleElements={...et},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:n,featurePage:a}=this.viewModel;i==="ready"&&s&&r.length>=n*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new we,this.addHandles([V(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),k),V(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),ye(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return ke({icon:()=>C(()=>import("./calcite-icon-7wB1xzh2.js"),__vite__mapDeps([6,7,1,2,8,9])),list:()=>C(()=>import("./calcite-list-E2bqcYXp.js"),__vite__mapDeps([18,1,2,8,19,9,20,21,22,23,24,25,26,27,7,28,29,30,31,32,33,34,35,36,37])),"list-item":()=>C(()=>import("./calcite-list-item-BfYt6AQV.js"),__vite__mapDeps([38,1,2,8,19,24,25,9,23,22,21,20,39,31,7,36,40])),notice:()=>C(()=>import("./calcite-notice-B4prE6yM.js"),__vite__mapDeps([41,1,2,42,9,8,22,24,25,23,43,31,7]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Wt(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:i,state:s}=this.viewModel;return!e&&!!t&&s==="ready"&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return Ne(e==null?void 0:e.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...et,...e}}render(){var t;const{state:e}=this.viewModel;return h("div",{class:this.classes(Y.base,G.widget)},(t=this._featureElementInfo)==null?void 0:t.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?h("div",{class:Y.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return h("span",{class:this.classes(He.loadingIndicator,G.rotating,Y.spinner)})}_renderLoading(){return h("div",{class:Y.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return h("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=Se(this.container)?"chevron-left":"chevron-right";return h("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){var r;const{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&((r=e.formattedAttributes)==null?void 0:r.global[t]);const s=e.state==="loading";return h("calcite-list-item",{class:this.classes(Y.listItem,{[Y.listItemHidden]:s}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){var e;return this.displayShowAllButton?h("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var e;return h("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}_renderFeatureObserver(){return h("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Y.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return h("calcite-list",null,e.toArray().map(t=>this._renderRelatedFeature(t)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return h("div",{class:this.classes(Y.listContainer,{[Y.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var e;return h("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e==null||e.forEach(i=>{this.addHandles(V(()=>[i.title,i.state],()=>this.scheduleRender(),k),t)}),this.scheduleRender()}_setupFeatureElementInfo(){var r;const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;(r=this._featureElementInfo)==null||r.set({description:i,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await Ht(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};o([l()],S.prototype,"_relatedFeatureIntersectionObserverNode",void 0),o([l({readOnly:!0})],S.prototype,"displayShowAllButton",null),o([l({readOnly:!0})],S.prototype,"displayListItems",null),o([l()],S.prototype,"description",null),o([l({readOnly:!0})],S.prototype,"featureCountDescription",null),o([l()],S.prototype,"headingLevel",void 0),o([l()],S.prototype,"title",null),o([l({type:Xe})],S.prototype,"viewModel",void 0),o([l(),J("esri/widgets/Feature/t9n/Feature")],S.prototype,"messages",void 0),o([l(),J("esri/t9n/common")],S.prototype,"messagesCommon",void 0),o([l()],S.prototype,"visibleElements",void 0),o([ve("visibleElements")],S.prototype,"castVisibleElements",null),S=o([P("esri.widgets.Feature.FeatureRelationship")],S);const tt=S;let Oi=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=s=>{}),this.preRequestCallback||(this.preLayerQueryCallback=s=>{})}};var de;const ki=1,it="content-view-models",st="relationship-view-models",rt={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let b=de=class extends Xt(ce){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=yt(this._graphicChanged,ki,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...rt},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent},this.addHandles(V(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),k))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return zt(Ze(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Yt(this.graphic)}castAbilities(e){return{...rt,...e}}get isTable(){var e;return((e=this._sourceLayer)==null?void 0:e.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",(e==null?void 0:e.clone())??null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){var e;return((e=this.view)==null?void 0:e.timeZone)??Ut}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof K&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof K&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof K&&t.previous()}async updateGeometry(){var a;const{graphic:e,spatialReference:t,_sourceLayer:i}=this;await(i==null?void 0:i.load());const s=i==null?void 0:i.objectIdField;if(!s||!e||!i)return;const r=(a=e==null?void 0:e.attributes)==null?void 0:a[s];if(r==null)return;const n=[r];if(!e.geometry){const c=await jt({layer:i,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}),d=c==null?void 0:c.geometry;d&&(e.geometry=d)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){qt(i)||(this._error=i,Oe.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(ht):typeof e=="string"?this._compileText(new _t({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(st),this.removeHandles(it),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){var r;const i=(r=e==null?void 0:e.graphic)==null?void 0:r.getObjectId(),s=t==null?void 0:t.getObjectId();return i!=null&&s!=null&&i===s}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){const{view:s,spatialReference:r}=this;t==null||t.filter(Boolean).forEach(n=>{e.some(a=>this._matchesFeature(a,n))||e.add(new de({abilities:{relationshipContent:!1},map:i,view:s,spatialReference:r,graphic:n}))}),e.forEach(n=>{(t==null?void 0:t.find(c=>this._matchesFeature(n,c)))||e.remove(n)})}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:s,contentElementViewModel:r}=e,n=s==null?void 0:s.type;r&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createFieldsVMParams(s,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createMediaVMParams(s,t))),n==="text"&&r.set(this._createTextVMParams(s)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:s,relationshipId:r,title:n,description:a}=e,{_sourceLayer:c,graphic:d,map:p}=this;if(!Bt(c))return;const u=new Xe({displayCount:i,graphic:d,orderByFields:s,relationshipId:r,layer:c,map:p,...this._compileTitleAndDesc({title:n,description:a})});return this.contentViewModels[t]=u,this.addHandles(ye(()=>u.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(u)),st),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:s,map:r,spatialReference:n,view:a,location:c}=this,d=new Ye({expressionInfo:i,graphic:s,interceptor:de.interceptor,map:r,spatialReference:n,view:a,location:c});return this.contentViewModels[t]=d,this.addHandles(V(()=>d.contentElementViewModel,()=>this._setExpressionContentVM(d,t),k),it),e}_compileAttachments(e,t){const{graphic:i}=this,{description:s,title:r}=e;return this.contentViewModels[t]=new ze({graphic:i,...this._compileTitleAndDesc({title:r,description:s})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:s,destroyer:r}=e;return this.contentViewModels[t]=new ge({graphic:i,creator:s,destroyer:r}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:s,graphic:r,formattedAttributes:n}=this,a=r==null?void 0:r.attributes,c=this._expressionAttributes,d=n.global;return{title:Q({attributes:a,fieldInfoMap:i,globalAttributes:d,expressionAttributes:c,layer:s,text:e}),description:Q({attributes:a,fieldInfoMap:i,globalAttributes:d,expressionAttributes:c,layer:s,text:t})}}_createFieldsVMParams(e,t){const i=this._effectivePopupTemplate,s=this.formattedAttributes,r={...s==null?void 0:s.global,...s==null?void 0:s.content[t]},n=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos),a=n==null?void 0:n.filter(({fieldName:u})=>mt(u)||Z(u)||r.hasOwnProperty(u)),c=i==null?void 0:i.expressionInfos,{description:d,title:p}=e;return{attributes:r,expressionInfos:c,fieldInfos:a,...this._compileTitleAndDesc({title:p,description:d})}}_compileFields(e,t){const i=e.clone(),s=new Ie(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=s,i.fieldInfos=s.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:s,_fieldInfoMap:r,_effectivePopupTemplate:n,relatedInfos:a,_sourceLayer:c,_expressionAttributes:d}=this,p=this.formattedAttributes,u=(s==null?void 0:s.attributes)??{},{description:m,mediaInfos:f,title:_}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,isAggregate:s==null?void 0:s.isAggregate,layer:c,fieldInfoMap:r,formattedAttributes:{...p==null?void 0:p.global,...p==null?void 0:p.content[t]},expressionAttributes:d,mediaInfos:f,popupTemplate:n,relatedInfos:a,...this._compileTitleAndDesc({title:_,description:m})}}_compileMedia(e,t){const i=e.clone(),s=new K(this._createMediaVMParams(e,t));return i.mediaInfos=s.formattedMediaInfos.slice(0),this.contentViewModels[t]=s,i}_createTextVMParams(e){var n;const{graphic:t,_fieldInfoMap:i,_sourceLayer:s,_expressionAttributes:r}=this;if(e&&e.text){const a=(t==null?void 0:t.attributes)??{},c=((n=this.formattedAttributes)==null?void 0:n.global)??{};e.text=Q({attributes:a,fieldInfoMap:i,globalAttributes:c,expressionAttributes:r,layer:s,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new ge(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:s}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,n=t==null?void 0:t.editFieldsInfo;return r&&n?Zt(n,i==null?void 0:i.attributes,s,t):void 0}_compileTitle(e){var c;const{_fieldInfoMap:t,_sourceLayer:i,graphic:s,_expressionAttributes:r}=this,n=(s==null?void 0:s.attributes)??{},a=((c=this.formattedAttributes)==null?void 0:c.global)??{};return Q({attributes:n,fieldInfoMap:t,globalAttributes:a,expressionAttributes:r,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;const i=e==null?void 0:e.title;return _e(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;const i=e==null?void 0:e.content;return _e(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:s,_effectivePopupTemplate:r}=this,n=this.map,a=this.view,c=this.spatialReference,d=this.location;if(t!==this._featureAbortController||!s)return;await Qt({graphic:s,popupTemplate:r,layer:i,spatialReference:c},e);const{content:{value:p},title:{value:u}}=await ee({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:m}}=await ee({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Si({expressionInfos:r==null?void 0:r.expressionInfos,spatialReference:c,graphic:s,map:n,interceptor:de.interceptor,view:a,options:e,location:d})});t===this._featureAbortController&&s&&(this._expressionAttributes=m,this._graphicExpressionAttributes={...s.attributes,...m},this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(u)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:s,graphic:r,relatedInfos:n,_sourceLayer:a,_fieldInfoMap:c,_graphicExpressionAttributes:d,timeZone:p}=this;i.content[t]=Ae({fieldInfos:s==null?void 0:s.fieldInfos,graphic:r,attributes:{...d,...e.attributes},layer:a,fieldInfoMap:c,relatedInfos:n,timeZone:p})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:s,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:a,_graphicExpressionAttributes:c,timeZone:d}=this;i.content[t]=Ae({fieldInfos:e.fieldInfos,graphic:s,attributes:{...c,...e.attributes},layer:n,fieldInfoMap:a,relatedInfos:r,timeZone:d})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:n,_graphicExpressionAttributes:a,timeZone:c}=this,d=t==null?void 0:t.fieldInfos,p={global:Ae({fieldInfos:d,graphic:i,attributes:a,layer:r,fieldInfoMap:n,relatedInfos:s,timeZone:c}),content:[]};return Array.isArray(e)&&e.forEach((u,m)=>{u.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:u,contentElementIndex:m,formattedAttributes:p}),u.type==="media"&&this._createMediaFormattedAttributes({contentElement:u,contentElementIndex:m,formattedAttributes:p})}),p}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Ze(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:s,_sourceLayer:r}=this;s.clear();const n=(r==null?void 0:r.associatedLayer)!=null?await(r==null?void 0:r.associatedLayer.load(i)):r;if(!n||!e)return;const a=t.filter(p=>p&&Z(p.fieldName));if(!(a!=null&&a.length))return;t.forEach(p=>this._configureRelatedInfo(p,n));const c=await gi({relatedInfos:s,layer:n},i);Object.keys(c).forEach(p=>{var f;const u=s.get(p.toString()),m=(f=c[p])==null?void 0:f.value;u&&m&&(u.layerInfo=m.data)});const d=await vi({graphic:e,relatedInfos:s,layer:n},i);Object.keys(d).forEach(p=>{var u;ui((u=d[p])==null?void 0:u.value,s.get(p.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,s=me(e.fieldName);if(!s)return;const{layerId:r,fieldName:n}=s;if(!r)return;const a=i.get(r.toString())||ci(r,t);a&&(wi({relatedInfo:a,fieldName:n,fieldInfo:e}),this.relatedInfos.set(r,a))}};b.interceptor=new Oi(Kt,Jt),o([l()],b.prototype,"_error",void 0),o([l()],b.prototype,"_featureAbortController",void 0),o([l({readOnly:!0})],b.prototype,"_effectivePopupTemplate",null),o([l({readOnly:!0})],b.prototype,"_fieldInfoMap",null),o([l({readOnly:!0})],b.prototype,"_sourceLayer",null),o([l()],b.prototype,"abilities",void 0),o([ve("abilities")],b.prototype,"castAbilities",null),o([l({readOnly:!0})],b.prototype,"content",void 0),o([l({readOnly:!0})],b.prototype,"contentViewModels",void 0),o([l()],b.prototype,"description",void 0),o([l({type:Boolean})],b.prototype,"defaultPopupTemplateEnabled",void 0),o([l({readOnly:!0})],b.prototype,"isTable",null),o([l({readOnly:!0})],b.prototype,"state",null),o([l({readOnly:!0})],b.prototype,"formattedAttributes",void 0),o([l({type:Pe,value:null})],b.prototype,"graphic",null),o([l({readOnly:!0})],b.prototype,"lastEditInfo",void 0),o([l({type:ft})],b.prototype,"location",void 0),o([l({readOnly:!0})],b.prototype,"relatedInfos",void 0),o([l()],b.prototype,"spatialReference",null),o([l()],b.prototype,"timeZone",null),o([l({readOnly:!0})],b.prototype,"title",void 0),o([l()],b.prototype,"map",null),o([l({readOnly:!0})],b.prototype,"waitingForContent",null),o([l()],b.prototype,"view",void 0),b=de=o([P("esri.widgets.Feature.FeatureViewModel")],b);const bt=b,T="esri-feature",A={base:T,container:`${T}__size-container`,title:`${T}__title`,main:`${T}__main-container`,btn:`${T}__button`,icon:`${T}__icon`,content:`${T}__content`,contentNode:`${T}__content-node`,contentNodeText:`${T}__content-node--text`,contentElement:`${T}__content-element`,text:`${T}__text`,lastEditedInfo:`${T}__last-edited-info`,fields:`${T}__fields`,fieldHeader:`${T}__field-header`,fieldData:`${T}__field-data`,fieldDataDate:`${T}__field-data--date`,loadingSpinnerContainer:`${T}__loading-container`,spinner:`${T}__loading-spinner`},Ni=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>dt(i)&&!i.destroyed?h("div",{class:A.contentNode,key:i},i.render()):i instanceof HTMLElement?h("div",{afterCreate:this._attachToNode,bind:i,class:A.contentNode,key:i}):Gt(i)?h("div",{afterCreate:this._attachToNode,bind:i.domNode,class:A.contentNode,key:i}):null}_attachToNode(i){const s=this;i.appendChild(s)}};return t=o([P("esri.widgets.Feature.ContentMixin")],t),t};var Ve;const nt={title:!0,content:!0,lastEditedInfo:!0},ot="relationship-handles";let F=Ve=class extends Ni(B){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...nt},this.viewModel=new bt}initialize(){this.addHandles(V(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),k))}loadDependencies(){return ke({notice:()=>C(()=>import("./calcite-notice-B4prE6yM.js"),__vite__mapDeps([41,1,2,42,9,8,22,24,25,23,43,31,7]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...nt,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){const{state:e}=this.viewModel,t=h("div",{class:A.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return h("div",{class:this.classes(A.base,G.widget)},t)}_renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return h("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?h("div",{key:"error-title",slot:"title"},e.errorMessage):null,h("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return h("div",{class:A.loadingSpinnerContainer,key:"loading-container"},h("span",{class:this.classes(He.loadingIndicator,G.rotating,A.spinner)}))}_renderContentContainer(){const{visibleElements:e}=this;return e.content?h("div",{class:A.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:e,title:t}=this;return e.title?h(at,{class:A.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?h("div",{class:A.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:h("div",{class:this.classes(A.contentNode,A.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){var s;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((s=i.content)!=null&&s[e.type]))return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:s}=t.viewModel;return i==="loading"||s.length>0?h("div",{class:this.classes(A.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?h("div",{class:A.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:h("div",{class:A.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){const{creator:i}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:i?h("div",{class:A.contentElement,key:this._buildKey("custom-element",t)},s.render()):null}_renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:h("div",{class:A.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:h("div",{class:A.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:s,user:r}=i,n=i.type==="edit"?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,a=Ne(n,{date:s,user:r});return h("div",{class:this.classes(A.lastEditedInfo,A.contentElement),key:"edit-info-element"},a)}_renderText(e,t){const i=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:i?h("div",{class:this.classes(A.contentElement,A.text),key:this._buildKey("text-element",t)},s.render()):null}_buildKey(e,...t){var i,s;return`${e}__${((s=(i=this.viewModel)==null?void 0:i.graphic)==null?void 0:s.uid)||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(ot),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){const{flowItems:t,visibleElements:i}=this;this.addHandles([ye(()=>e,"select-record",({featureViewModel:s})=>{t&&(s.abilities={relationshipContent:!0},t.push(new Ve({flowItems:t,viewModel:s,visibleElements:i})))}),ye(()=>e,"show-all-records",()=>{if(!t)return;const{viewModel:s}=e;s.showAllEnabled=!0;const r=new tt({visibleElements:{title:!1,description:!1},viewModel:s});this._addFeatureRelationshipHandles(r),t.push(r)})],ot)}_setupContentWidgets(){var r;this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=(r=this.viewModel)==null?void 0:r.content,{contentViewModels:s}=this.viewModel;if(Array.isArray(i))i.forEach((n,a)=>{if(n.type==="attachments"&&(this._contentWidgets[a]=new ni({displayType:n.displayType,headingLevel:t.title?e+1:e,viewModel:s[a]})),n.type==="fields"&&(this._contentWidgets[a]=new gt({viewModel:s[a]})),n.type==="media"&&(this._contentWidgets[a]=new vt({viewModel:s[a]})),n.type==="text"&&(this._contentWidgets[a]=new he({viewModel:s[a]})),n.type==="custom"&&(this._contentWidgets[a]=new he({viewModel:s[a]})),n.type==="expression"&&(this._contentWidgets[a]=new Pi({viewModel:s[a]})),n.type==="relationship"){const c=new tt({viewModel:s[a]});this._addFeatureRelationshipHandles(c),this._contentWidgets[a]=c}},this);else{const n=s[0];n&&!n.destroyed&&(this._contentWidgets[0]=new he({viewModel:n}))}this.scheduleRender()}};o([l()],F.prototype,"graphic",null),o([l()],F.prototype,"defaultPopupTemplateEnabled",null),o([l()],F.prototype,"flowItems",void 0),o([l()],F.prototype,"headingLevel",void 0),o([l({readOnly:!0})],F.prototype,"isTable",null),o([l()],F.prototype,"label",null),o([l(),J("esri/widgets/Feature/t9n/Feature")],F.prototype,"messages",void 0),o([l(),J("esri/t9n/common")],F.prototype,"messagesCommon",void 0),o([l()],F.prototype,"spatialReference",null),o([l()],F.prototype,"timeZone",null),o([l({readOnly:!0})],F.prototype,"title",null),o([l()],F.prototype,"visibleElements",void 0),o([ve("visibleElements")],F.prototype,"castVisibleElements",null),o([l()],F.prototype,"map",null),o([l()],F.prototype,"view",null),o([l({type:bt})],F.prototype,"viewModel",void 0),F=Ve=o([P("esri.widgets.Feature")],F);const Di=F,ns=Object.freeze(Object.defineProperty({__proto__:null,default:Di},Symbol.toStringTag,{value:"Module"}));export{ns as F,bt as Y,Ni as n,A as t,Di as x};
