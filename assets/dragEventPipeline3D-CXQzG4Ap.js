import{dP as b,d_ as m,d$ as $,e0 as x,cc as g,ad as E,bO as i,e1 as v,bM as D,ce as w,c5 as y,e2 as S,e3 as H,c0 as N,df as T,cn as R,ct as P,e4 as G,e5 as U,ci as F,c8 as h,ca as A}from"./index-DPJiPkbh.js";import{g as O}from"./ray-cdkbAool.js";import{T as k,t as q,i as _}from"./ElevationProvider-DuAnZ1w5.js";import{w as C}from"./verticalOffsetUtils-5CRVG66a.js";import{Y as j}from"./dragEventPipeline-C143Img8.js";function z(e,n){return M(e,()=>n)}function re(e){return M(e,n=>n.plane)}function M(e,n){const t=i(),l=i();let s=!1;return r=>{const o=n(r);if(r.action==="start"){const c=m(r.screenStart,$(x.get())),u=O(e.state.camera,c,I);u!=null&&(s=g(o,u,t))}if(!s)return null;const a=m(r.screenEnd,$(x.get())),d=O(e.state.camera,a,I);return d==null?null:g(o,d,l)?{...r,renderStart:t,renderEnd:l,plane:o,ray:d}:null}}function B(e,n,t=0,l=null,s=null){let r=null;return o=>{if(o.action==="start"&&(r=e.sceneIntersectionHelper.intersectElevationFromScreen(S(o.screenStart.x,o.screenStart.y),n,t,s),r!=null&&l!=null&&!H(r,r,l))||r==null)return null;const a=e.sceneIntersectionHelper.intersectElevationFromScreen(S(o.screenEnd.x,o.screenEnd.y),n,t,s);return a!=null&&(l==null||H(a,a,l))?{...o,mapStart:r,mapEnd:a}:null}}function J(e,n,t,l=null,s=null){return B(e,t,v(n,e,t),l,s)}function K(e,n,t,l=null,s=null){return J(e,t,D(n),l,s)}function le(e,n,t,l){const s=n.toMap(e.screenStart,{include:[t]});return s!=null?K(n,t,s,l):null}function L(e,n){const t=V,l=W,s=N();e.renderCoordsHelper.worldUpAtPosition(n,t);const r=T(P(s),t,R(l,n,e.state.camera.eye));return T(r,r,t),G(n,r,s)}function se(e,n,t){let l=null;const s=new j;return s.next(z(e,L(e,n))).next(Y(e,n)).next(Q(e,t)).next(r=>{r.mapEnd.x=r.mapStart.x,r.mapEnd.y=r.mapStart.y,l=r}),r=>(l=null,s.execute(r),l)}function Y(e,n){const t=i(),l=w(n);e.renderCoordsHelper.worldUpAtPosition(n,t);const s=i(),r=i(),o=a=>(R(a,a,n),U(t,a,a),e.viewingMode==="global"&&w(a)*Math.sign(F(t,a))<.001-l&&R(a,h(a,t,.001),n),A(a,a,n),a);return a=>(a.renderStart=o(y(s,a.renderStart)),a.renderEnd=o(y(r,a.renderEnd)),a)}function Q(e,n){const t=e.renderCoordsHelper;return l=>{const s=t.fromRenderCoords(l.renderStart,new E({spatialReference:n})),r=t.fromRenderCoords(l.renderEnd,new E({spatialReference:n}));return s!=null&&r!=null?{...l,mapStart:s,mapEnd:r}:null}}var f;function ae(e){let n=null;return t=>{switch(t.action){case"start":n=e.disableDisplay();break;case"end":case"cancel":n!=null&&(n.remove(),n=null)}return t}}function oe(e,n=null){const t=k(e.state.viewingMode);t.options.selectionMode=!0,t.options.store=q.MIN,t.options.hud=!1;const l=S(),s={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},r=i(),o=n??e.spatialReference,a=c=>{e.map.ground&&e.map.ground.opacity<1?s.exclude.add(C):s.exclude.delete(C),e.sceneIntersectionHelper.intersectIntersectorScreen(m(c,l),t,s);const u=t.results.min;let p;if(u.getIntersectionPoint(r))p=u.intersector===_.TERRAIN?f.GROUND:f.OTHER;else{if(!t.results.ground.getIntersectionPoint(r))return null;p=f.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(r,new E({spatialReference:o})),surfaceType:p}};let d;return c=>{if(c.action==="start"){const p=a(c.screenStart);d=p!=null?p.location:null}if(d==null)return null;const u=a(c.screenEnd);return(u==null?void 0:u.location)!=null?{...c,mapStart:d,mapEnd:u.location,surfaceType:u.surfaceType}:null}}(function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"})(f||(f={}));const V=i(),W=i(),I=b();export{Q as A,re as C,J as D,f as F,K as M,le as N,z as O,se as k,ae as q,oe as z};
